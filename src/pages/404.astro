---
// Redirect to 404 page for user's system locale
import { LOCALES, DEFAULT_LOCALE } from "@/i18n";

const langs = Object.keys(LOCALES);
const base = import.meta.env.BASE_URL || "/";
const defaultLocale = DEFAULT_LOCALE;
---

<html lang={DEFAULT_LOCALE}>
  <head>
    <meta charset="UTF-8" />
    <title>404 PAGE NOT FOUND</title>
    <link rel="canonical" href={Astro.site} />

    <noscript>
      <meta
        http-equiv="refresh"
        content={`0;url=${base}${DEFAULT_LOCALE}/404/`}
      />
    </noscript>

    <script is:inline define:vars={{ langs, base, defaultLocale }}>
      const urlHasLang = langs.includes(location.pathname.split("/")[1]);
      const localStorageHasLang =
        localStorage.selectedLang && langs.includes(localStorage.selectedLang);
      const referrerHasLang =
        document.referrer &&
        new URL(document.referrer).host == location.host &&
        langs.includes(new URL(document.referrer).pathname.split("/")[1]);

      if (urlHasLang) {
        localStorage.userAccessPath = location.pathname;
        location.href = `${base}${location.pathname.split("/")[1]}/404/`;
      } else if (localStorageHasLang) {
        location.href = base + localStorage.selectedLang + location.pathname;
      } else if (referrerHasLang) {
        const referrerLang = new URL(document.referrer).pathname.split("/")[1];
        location.href = base + referrerLang + location.pathname;
      } else {
        location.href = base + defaultLocale + location.pathname;
      }
    </script>
  </head>
  <body>
    <h1>404 PAGE NOT FOUND</h1>
    <a href={base}>TOP PAGE</a>
  </body>
</html>
